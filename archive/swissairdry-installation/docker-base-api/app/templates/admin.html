{% extends "base.html" %}

{% block title %}SwissAirDry - Admin Dashboard{% endblock %}

{% block content %}
<h1><i class="fas fa-cog me-2"></i>Admin Dashboard</h1>
<p class="lead">Verwaltung des SwissAirDry-Systems</p>

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-users me-2"></i>Benutzerverwaltung</h5>
                <p class="card-text">Verwalten Sie Benutzer und deren Zugriffsrechte.</p>
                <div class="d-grid">
                    <a href="/admin/users" class="btn btn-primary">
                        <i class="fas fa-user-cog me-2"></i>Benutzer verwalten
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-user-tag me-2"></i>Gruppenverwaltung</h5>
                <p class="card-text">Verwalten Sie Benutzergruppen und deren Berechtigungen.</p>
                <div class="d-grid">
                    <a href="/admin/groups" class="btn btn-primary">
                        <i class="fas fa-users-cog me-2"></i>Gruppen verwalten
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-file-csv me-2"></i>CSV-Import</h5>
                <p class="card-text">Importieren Sie Daten aus CSV-Dateien.</p>
                <div class="d-grid">
                    <a href="/admin/csv-import" class="btn btn-primary">
                        <i class="fas fa-file-import me-2"></i>CSV importieren
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-2">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-server me-2"></i>Systemstatus</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <tbody>
                            <tr>
                                <th scope="row">API-Version</th>
                                <td><span class="badge bg-success">1.0.0</span></td>
                            </tr>
                            <tr>
                                <th scope="row">Datenbank</th>
                                <td><span class="badge bg-success">Verbunden</span></td>
                            </tr>
                            <tr>
                                <th scope="row">MQTT-Broker</th>
                                <td><span class="badge bg-success">Online</span></td>
                            </tr>
                            <tr>
                                <th scope="row">Nextcloud</th>
                                <td><span id="nextcloud-status" class="badge bg-warning">Wird gepr체ft...</span></td>
                            </tr>
                            <tr>
                                <th scope="row">Speichernutzung</th>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-chart-bar me-2"></i>Systemstatistiken</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="border rounded p-3 text-center bg-light">
                            <h3 class="text-primary">5</h3>
                            <small class="text-muted">Aktive Benutzer</small>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="border rounded p-3 text-center bg-light">
                            <h3 class="text-success">120</h3>
                            <small class="text-muted">Registrierte Ger채te</small>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="border rounded p-3 text-center bg-light">
                            <h3 class="text-info">35</h3>
                            <small class="text-muted">Aktive Auftr채ge</small>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="border rounded p-3 text-center bg-light">
                            <h3 class="text-warning">12k+</h3>
                            <small class="text-muted">Messungen</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-2">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-cogs me-2"></i>Systemkonfiguration</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="api_domain" class="form-label">API-Domain</label>
                            <input type="text" class="form-control" id="api_domain" value="localhost:5000" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="database_url" class="form-label">Datenbank-URL</label>
                            <input type="text" class="form-control" id="database_url" value="postgresql://swissairdry:******@postgres:5432/swissairdry" readonly>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="mqtt_broker" class="form-label">MQTT-Broker</label>
                            <input type="text" class="form-control" id="mqtt_broker" value="mqtt:1883" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="nextcloud_url" class="form-label">Nextcloud-URL</label>
                            <input type="text" class="form-control" id="nextcloud_url" value="" readonly>
                        </div>
                    </div>
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-primary" disabled>
                        <i class="fas fa-save me-2"></i>Konfiguration speichern
                    </button>
                    <button type="button" class="btn btn-danger" disabled>
                        <i class="fas fa-sync-alt me-2"></i>System neustarten
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Nextcloud-Verbindung pr체fen
        $.ajax({
            url: '/nextcloud-connect',
            method: 'GET',
            success: function(response) {
                if (response.status === 'ok') {
                    $('#nextcloud-status').removeClass('bg-warning').addClass('bg-success').text('Verbunden');
                    $('#nextcloud_url').val(response.nextcloud_url);
                } else if (response.status === 'warning') {
                    $('#nextcloud-status').removeClass('bg-warning').addClass('bg-warning').text('Nicht konfiguriert');
                } else {
                    $('#nextcloud-status').removeClass('bg-warning').addClass('bg-danger').text('Fehler');
                }
            },
            error: function() {
                $('#nextcloud-status').removeClass('bg-warning').addClass('bg-danger').text('Fehler');
            }
        });
    });
</script>
{% endblock %}